---
title: "Sex Differences in Traffic Stops and Searches Across Three States"
format: html
execute:

  echo: true

  warning: false

  message: false
---

## Setting up connection

```{r}
library(DBI)
library(RMariaDB)

con_traffic <- DBI::dbConnect(
  RMariaDB::MariaDB(),
  dbname   = "traffic",
  host     = Sys.getenv("TRAFFIC_HOST"),
  user     = Sys.getenv("TRAFFIC_USER"),
  password = Sys.getenv("TRAFFIC_PWD")
)
```

## Introduction

This analysis uses the Stanford Open Policing Project SQL database to examine sex differences in traffic stops across three statewide agencies: Colorado, Connecticut, and Illinois. The focus is on two related questions:

1.  How do the numbers of stops differ between male and female drivers?

2.  Among stopped drivers, how does the probability of a search differ by sex, and does this pattern vary by state?

All data wrangling is performed in SQL by aggregating three statewide tables (`co_statewide_2020_04_01`, `ct_statewide_2020_04_01`, and `il_statewide_2020_04_01`) into summaries by subject sex and state. The resulting summaries are then visualized in R with bar plots to compare stop volumes and search rates across states.

## Data wrangling (SQL)

Total stops by sex and state stored as `stops_sex_three_states`.

```{sql}
#| connection: con_traffic
#| output.var: "stops_sex_three_states"
SELECT
  'CO statewide' AS dataset,
  subject_sex,
  COUNT(*) AS n_stops
FROM
  co_statewide_2020_04_01
WHERE
  subject_sex IN ('male', 'female')
GROUP BY
  subject_sex

UNION ALL

SELECT
  'CT statewide' AS dataset,
  subject_sex,
  COUNT(*) AS n_stops
FROM
  ct_statewide_2020_04_01
WHERE
  subject_sex IN ('male', 'female')
GROUP BY
  subject_sex

UNION ALL

SELECT
  'IL statewide' AS dataset,
  subject_sex,
  COUNT(*) AS n_stops
FROM
  il_statewide_2020_04_01
WHERE
  subject_sex IN ('male', 'female')
GROUP BY
  subject_sex;
  
```

Search counts and rates by sex and state stored as `search_sex_three_states`.)

```{sql}
#| connection: con_traffic
#| output.var: "search_sex_three_states"
SELECT
  'CO statewide' AS dataset,
  subject_sex,
  COUNT(*) AS n_stops,
  SUM(CASE WHEN search_conducted = TRUE THEN 1 ELSE 0 END) AS n_searches,
  SUM(CASE WHEN search_conducted = TRUE THEN 1 ELSE 0 END) / COUNT(*) AS search_rate
FROM
  co_statewide_2020_04_01
WHERE
  subject_sex IN ('male', 'female')
GROUP BY
  subject_sex

UNION ALL

SELECT
  'CT statewide' AS dataset,
  subject_sex,
  COUNT(*) AS n_stops,
  SUM(CASE WHEN search_conducted = TRUE THEN 1 ELSE 0 END) AS n_searches,
  SUM(CASE WHEN search_conducted = TRUE THEN 1 ELSE 0 END) / COUNT(*) AS search_rate
FROM
  ct_statewide_2020_04_01
WHERE
  subject_sex IN ('male', 'female') 
GROUP BY
  subject_sex

UNION ALL

SELECT
  'IL statewide' AS dataset,
  subject_sex,
  COUNT(*) AS n_stops,
  SUM(CASE WHEN search_conducted = TRUE THEN 1 ELSE 0 END) AS n_searches,
  SUM(CASE WHEN search_conducted = TRUE THEN 1 ELSE 0 END) / COUNT(*) AS search_rate
FROM
  il_statewide_2020_04_01
WHERE
  subject_sex IN ('male', 'female')
GROUP BY
  subject_sex;
```

```{r}
DBI::dbDisconnect(con_traffic)
```

## Results and Figures

#### **Figure 1. Number of Traffic Stops by Subject Sex in Colorado, Connecticut, and Illinois (Statewide)**

```{r}
library(ggplot2)

# Plotting Figure 1 

ggplot(stops_sex_three_states, aes(x = subject_sex, y = n_stops, fill = subject_sex)) +
  geom_col() +
  facet_wrap(~ dataset, scales = "free_y") +
  labs(
    title = "Number of stops by subject sex in CO, CT, and IL statewide",
    x = "Subject sex",
    y = "Number of stops",
    fill = "Subject sex"
  ) +
  theme_minimal()
```

Figure 1 shows the total number of traffic stops for male and female subjects in Colorado, Connecticut, and Illinois statewide. In all three states, male drivers are stopped more often than female drivers, though the magnitude of the difference varies, with Illinois showing especially large absolute counts. These patterns suggest that men account for a larger share of documented stops in each jurisdiction, which could reflect differences in driving exposure, differences in enforcement priorities, or both; this analysis cannot distinguish between those explanations.

#### **Figure 2. Search Rates by Subject Sex in Colorado, Connecticut, and Illinois (Statewide)**

```{r}
# Plotting Figure 2 
ggplot(search_sex_three_states,
       aes(x = subject_sex, y = search_rate, fill = subject_sex)) +
  geom_col() +
  facet_wrap(~ dataset) +
  labs(
    title = "Search rate by subject sex in CO, CT, and IL statewide",
    x = "Subject sex",
    y = "Search rate (proportion of stops with a search)",
    fill = "Subject sex"
  ) +
  theme_minimal()
```

Figure 2 displays the search rate, defined as the proportion of stops that involve a search, for male and female drivers in each statewide agency. In Connecticut and Illinois, male subjects have noticeably higher search rates than female subjects, indicating that once stopped, men are more likely to be searched in these states. Colorado shows much lower search rates overall and only a small difference between sexes, suggesting that search practices there may be more restrictive or more uniform across male and female drivers.

## Conclusion

Using SQL to aggregate the Stanford Open Policing Project statewide tables for Colorado, Connecticut, and Illinois, this analysis compares both the volume of stops and the likelihood of searches by subject sex.

-   **Stop volume:** Across all three states, male drivers are stopped substantially more often than female drivers, with particularly large absolute numbers in Illinois. This implies that men experience more direct contact with traffic enforcement, which could stem from greater time spent driving, differences in vehicle use, or sex-focused patterns in enforcement focus.

-   **Search rates:** In Connecticut and Illinois, male drivers also have higher search rates than female drivers, meaning that conditional on being stopped, men are more likely to be searched. Colorado, in contrast, has low search rates for both groups and only a slight sex difference, consistent with state‑specific policies or practices that limit searches.

Together, these results indicate that sex differences in traffic stops are multidimensional: men in these data face both higher exposure (more stops) and, in some states, more intrusive outcomes (higher search rates). At the same time, the differences across states highlight that these patterns are shaped by local practices and legal environments, underscoring the value of multi‑state data for separating broad structural trends from jurisdiction‑specific policies.

## References

Pierson, E., Simoiu, C., Overgoor, J., Corbett-Davies, S., Jenson, D., Shoemaker, A., Ramachandran, V., et al. (2020). A large-scale analysis of racial disparities in police stops across the United States. *Nature Human Behaviour*, 4(7), 736–745.
